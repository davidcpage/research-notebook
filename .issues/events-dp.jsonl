{"ts":"2025-12-15T13:41:44Z","type":"created","id":"dp-001","title":"Session parser - parse Claude Code JSONL transcripts","issue_type":"task","priority":2,"description":"Parse Claude Code session JSONL files (~/.claude/projects/{project}/{session}.jsonl) into structured format for display.\n\n**Design doc:** dev/planning/features/session-card-type.md (see 'Session File Format Analysis' section)\n\n**Deliverables:**\n- parseSessionFile(jsonlContent) function\n- Handle message types: summary, user, assistant, file-history-snapshot\n- Extract metadata: session_id, timestamps, model, token counts\n- Parse tool_use and tool_result blocks within messages\n\nThis is foundational work for the session card type feature.","labels":["enhancement"]}
{"ts":"2025-12-15T13:42:00Z","type":"created","id":"dp-002","title":"Session template and layouts","issue_type":"task","priority":2,"description":"Add session template with schema and layout definitions for card/viewer display.\n\n**Design doc:** dev/planning/features/session-card-type.md (see 'Template Design' section)\n\n**Deliverables:**\n- Add 'session' to getDefaultTemplates()\n- Add .session.json extension mapping\n- Define schema: title, summary, session_id, project, started, ended, git_branch, model, total_tokens, transcript, tags\n- Card layout: summary + message count + tokens + date\n- Viewer layout: hierarchical message display shell (actual rendering in separate issue)","depends_on":["dp-001"],"labels":["enhancement"]}
{"ts":"2025-12-15T13:42:11Z","type":"created","id":"dp-003","title":"Session viewer - TUI-styled message renderer","issue_type":"task","priority":2,"description":"Render session messages with TUI aesthetic and collapsible detail levels.\n\n**Design doc:** dev/planning/features/session-card-type.md (see 'UI Design: Message Display' section)\n\n**Deliverables:**\n- renderUserMessage(msg, collapsed)\n- renderAssistantMessage(msg, collapsed)\n- renderToolCall(tool, collapsed)\n- renderToolResult(result, collapsed)\n- CSS for TUI aesthetic (dark bg, monospace, box-drawing chars)\n- Click handlers for expand/collapse\n- Three detail levels: summary view, message view, tool detail","depends_on":["dp-002"],"labels":["enhancement"]}
{"ts":"2025-12-15T13:42:20Z","type":"created","id":"dp-004","title":"Session import mechanism","issue_type":"task","priority":2,"description":"Allow importing Claude Code session files into the notebook.\n\n**Design doc:** dev/planning/features/session-card-type.md (see 'Phase 4: Import Mechanism' section)\n\n**Deliverables:**\n- 'Import Session' button (in toolbar or section menu)\n- File picker for .jsonl files\n- Parse using session parser and save as .session.json\n- Place in user-selected section\n\n**Future consideration:** Session browser modal showing available sessions from ~/.claude/projects/","depends_on":["dp-002"],"labels":["enhancement"]}
{"ts":"2025-12-15T13:42:31Z","type":"created","id":"dp-005","title":"Session cards - integrate with sessions skill summaries","issue_type":"feature","priority":3,"description":"Optionally integrate session cards with the sessions skill from https://github.com/davidcpage/skill-issues if available.\n\n**Concept:** The sessions skill stores curated summaries in .memory/sessions.jsonl with learnings, open questions, and next actions. Session cards could display these summaries as a high-level overview, with the ability to drill down into full transcript logs.\n\n**Two-tier approach:**\n- Sessions skill: curated learnings and summaries (what we learned)\n- Session cards: full conversation archives (what was said)\n\n**Implementation ideas:**\n- Detect if .memory/sessions.jsonl exists\n- Match session cards to session summaries by date/topic\n- Show summary prominently in card/viewer if available\n- Link between session summary and full transcript","depends_on":["dp-002"],"labels":["enhancement"]}
{"ts":"2025-12-15T13:43:02Z","type":"created","id":"dp-006","title":"Tag search and filtering","issue_type":"feature","priority":2,"description":"Add ability to filter cards by tag.\n\n**Design doc:** dev/planning/features/tags-future.md (see 'Search by Tag' section)\n\n**Deliverables:**\n- Filter cards by tag in search/filter UI\n- Keyboard shortcut for tag filter (e.g., `t:ongoing`)\n- Tag facets in sidebar or filter dropdown\n\n**Related future work:**\n- Tag configuration in settings (custom colors/icons)\n- Multi-tag display improvements (limit display with '+X more')","labels":["enhancement"]}
{"ts":"2025-12-15T13:43:24Z","type":"created","id":"dp-007","title":"Code file inference for repository exploration","issue_type":"feature","priority":2,"description":"Display arbitrary code files (.py, .js, .ts, etc.) as syntax-highlighted cards without requiring frontmatter.\n\n**Design doc:** dev/planning/features/code-repo-exploration.md (see 'Gaps to Fill' section)\n\n**Context:** Enables using the notebook to explore code repositories alongside Claude Code, without polluting repo source files with frontmatter.\n\n**Deliverables:**\n- Infer title from filename\n- Display content as syntax-highlighted code (read-only)\n- No frontmatter injection\n\n**Related work:**\n- Readonly sections flag (prevent accidental edits)\n- Deeper section paths (path: 'cloned-repo/src/components')","labels":["enhancement"]}
{"ts":"2025-12-15T13:43:34Z","type":"created","id":"dp-008","title":"Media library modal","issue_type":"feature","priority":3,"description":"Grid view modal for browsing and managing images in assets/ directory.\n\n**Design doc:** dev/planning/architecture/filesystem-simplification.md (see 'Phase 4: Assets as First-Class Citizens - Deferred' section)\n\n**Deliverables:**\n- Modal showing grid of images from assets/ directory\n- Drag-drop upload to add new images\n- Click to copy reference/insert into editor\n\n**Related work:**\n- 'Insert image' button in markdown editor","labels":["enhancement"]}
{"ts":"2025-12-15T14:04:36Z","type":"created","id":"dp-009","title":"Code cell split-pane scrolling bug","issue_type":"bug","priority":2,"description":"In code cells in preview mode (split-pane layout), scrolling acts on input and output panes together. If the input code is long, the output gets positioned badly in the left pane.\n\n**Expected behavior:** Output pane should probably not scroll (or scroll independently).\n\n**Current behavior:** Both panes scroll together, causing output to be displaced when input is long.\n\n**Location:** Split-pane layout CSS/JS in research_notebook.html (likely in HTML_HEAD or RENDER_FUNCTIONS sections)"}
{"ts":"2025-12-15T14:06:23Z","type":"closed","id":"dp-009","reason":"Fixed - added height: 100% to both split panes and changed left pane alignment to flex-start so output stays pinned at top"}
{"ts":"2025-12-15T14:10:57Z","type":"note","id":"dp-009","content":"Actual fix required multiple CSS changes: (1) viewer-split-pane: height: 100%, (2) viewer-split-left: overflow: hidden + align-items: flex-start, (3) viewer-content:has(.viewer-split-pane): overflow: hidden, (4) viewer-split-right: max-height: calc(90vh - 120px). Key learning: height: 100% chains don't resolve in flex contexts - viewport-based max-height is more reliable."}
{"ts":"2025-12-15T14:22:24Z","type":"created","id":"dp-010","title":"Review claude-mem repo for session card inspiration","issue_type":"task","priority":3,"description":"Review https://github.com/thedotmack/claude-mem for features that might inform our session cards work. The repo appears to have nice UI for summarising, displaying and searching past sessions. Much of it may be overkill but could provide useful ideas for: session summaries, search over past sessions, session display/UI patterns.","labels":["research","sessions"]}
{"ts":"2025-12-15T14:23:14Z","type":"updated","id":"dp-010","priority":1,"reason":"Could inform design of session cards feature - better to review before implementation"}
{"ts":"2025-12-15T14:24:27Z","type":"note","id":"dp-010","content":"Reviewed README. Key features that might inform session cards:\n\n**Relevant patterns:**\n1. **Auto-generated summaries** - Summaries created at session end via lifecycle hooks\n2. **Multi-concept tagging** - Tags like: discovery, problem-solution, pattern, decision, bugfix, feature, refactor\n3. **File reference tracking** - Links observations to specific files touched\n4. **Progressive disclosure** - Layered retrieval showing token costs for context decisions\n5. **Hybrid search** - Keyword (FTS5) + semantic (Chroma vector) search\n6. **Web viewer UI** - Real-time visualization at localhost:37777\n\n**Likely overkill for us:**\n- Lifecycle hooks intercepting every tool use\n- Full SQLite + vector DB infrastructure\n- MCP integration\n- Endless Mode (context compression)\n\n**Architecture:** TypeScript/Bun worker service on port 37777, SQLite with FTS5 for storage, Chroma for semantic search, Claude Agent SDK for extracting learnings from tool outputs."}
{"ts":"2025-12-15T14:27:25Z","type":"note","id":"dp-010","content":"UI Code Review - Key patterns:\n\n**Summary Card (SummaryCard.tsx)**\n- Structured sections: Investigated, Learned, Completed, Next Steps (each with icon)\n- Request/title at top, project badge, session ID and timestamp in footer\n- Amber/gold color scheme to distinguish from other card types\n\n**Observation Card (ObservationCard.tsx)**\n- Progressive disclosure via toggle buttons: subtitle (default) \u2192 facts (bullet list) \u2192 narrative (full text)\n- Type badge (decision, bugfix, feature, refactor, etc.)\n- Metadata: concepts as small badges, files read/modified\n- Toggle buttons in header: 'facts' and 'narrative' - only one active at a time\n\n**Feed (Feed.tsx)**\n- Simple chronological feed combining observations, summaries, prompts\n- Sorted by created_at_epoch descending\n- Infinite scroll via IntersectionObserver\n\n**Color coding by card type:**\n- Summary: amber/gold (--color-bg-summary, --color-border-summary)\n- Prompt: purple \n- Observation: blue\n\n**CSS patterns:**\n- Comprehensive CSS variable system (light + dark themes)\n- Cards expand in-place with toggles (no modal viewer)\n- Type badges: uppercase, small, colored background\n\n**Data model (types.ts):**\n- Observation: type, title, subtitle, narrative, facts (JSON array), concepts (JSON array), files_read, files_modified\n- Summary: request, investigated, learned, completed, next_steps\n- Both have: id, project, created_at_epoch"}
{"ts":"2025-12-15T14:33:50Z","type":"note","id":"dp-010","content":"Design Implications for Sessions Skill / Session Cards:\n\n**Current sessions skill structure:**\n- learnings (array) \u2713 maps to 'learned'\n- open_questions (array) - unique to our skill\n- next_actions (array) \u2713 maps to 'next_steps'\n- issues_worked (array) - could inform 'completed'\n\n**Claude-mem summary structure:**\n- investigated - what was explored\n- learned - key discoveries\n- completed - what got done\n- next_steps - follow-up items\n\n**Gap analysis:**\n1. We lack 'investigated' - what areas/files were explored\n2. We lack explicit 'completed' - issues_worked is indirect\n3. We have open_questions which they don't (valuable, keep)\n\n**Two approaches for session cards:**\n\nA) **Full transcripts** (current design doc approach)\n- Import raw Claude Code JSONL\n- Complex hierarchical viewer with expand/collapse\n- Large files, rich detail but hard to scan\n\nB) **Structured summaries** (claude-mem inspired)\n- Use sessions skill to capture structured data as we go\n- Cards display sections: Explored | Learned | Completed | Next Steps | Open Questions\n- Smaller, scannable, but loses transcript detail\n\n**Hybrid approach:**\n- Session cards store BOTH structured summary AND raw transcript\n- Card preview shows structured summary (scannable)\n- Viewer offers 'Full Transcript' tab for drill-down\n- Sessions skill evolves to capture richer structure during session\n\n**Possible sessions skill field additions:**\n- explored/investigated: files/areas touched\n- completed: tasks finished (derive from issues closed?)\n- decisions: key choices made (currently mixed into learnings)"}
{"ts":"2025-12-15T14:34:30Z","type":"closed","id":"dp-010","reason":"Done - Reviewed claude-mem repo and extracted design lessons:\n\n1. Added 'Structured Summaries' section to dev/planning/features/session-card-type.md\n2. Key pattern: Structured sections (Explored/Learned/Completed/Next Steps) instead of raw transcripts\n3. Proposed hybrid approach: structured summary for cards + optional transcript for drill-down\n4. Identified sessions skill evolution: add 'explored', 'completed', 'decisions' fields\n5. Progressive disclosure UI pattern from claude-mem (toggle buttons)\n\nReference: Issue notes contain full review findings from README and UI code analysis."}
{"ts":"2025-12-15T14:38:06Z","type":"note","id":"dp-005","content":"REVISED: This should be the PRIMARY approach for session cards, not a secondary integration.\n\nWith the hybrid approach from claude-mem review (#010):\n1. Sessions skill already captures: learnings, open_questions, next_actions, issues_worked\n2. This maps directly to card sections: Learned, Open Questions, Next Steps, Completed\n3. Only gap is 'explored' - but learnings often implicitly cover this\n\nProposed change: Make this issue the foundation, unblock from #002, and have #002 depend on THIS instead.\n\nCard structure:\n- Card preview shows structured sections from .memory/sessions.jsonl\n- Optional: link to full transcript for drill-down (via #001, #003)"}
{"ts":"2025-12-15T14:38:12Z","type":"updated","id":"dp-005","depends_on":[],"reason":"Removed blockers: 002"}
{"ts":"2025-12-15T14:40:00Z","type":"updated","id":"dp-005","priority":1,"reason":"Elevating to primary approach for session cards based on claude-mem review (#010). Structured summaries from sessions skill are the foundation, not an optional integration."}
{"ts":"2025-12-15T14:40:01Z","type":"note","id":"dp-001","content":"REVISED ROLE: Now optional for full transcript drill-down only.\n\nWith hybrid approach (#005 as primary), this parser is only needed if we want to offer 'View Full Transcript' in the session viewer. Not blocking for MVP session cards.\n\nConsider: Move to backlog (priority 4) until structured summaries are working."}
{"ts":"2025-12-15T14:40:02Z","type":"note","id":"dp-002","content":"REVISED: Should depend on #005 (sessions skill integration), not #001 (JSONL parser).\n\nNew schema should follow hybrid approach from design doc:\n- Primary: structured fields (learnings, completed, next_steps, open_questions)\n- Optional: transcript field for full drill-down\n\nSee dev/planning/features/session-card-type.md 'Alternative: Structured Summaries' section."}
{"ts":"2025-12-15T14:40:03Z","type":"note","id":"dp-003","content":"REVISED ROLE: Now optional for full transcript drill-down only.\n\nWith hybrid approach, the primary viewer shows structured sections (Learned, Completed, etc.). The TUI message renderer is only needed for optional 'Full Transcript' tab.\n\nConsider: Move to backlog (priority 4) until structured summaries are working."}
{"ts":"2025-12-15T14:40:04Z","type":"note","id":"dp-004","content":"REVISED ROLE: Optional mechanism to import historical sessions.\n\nWith hybrid approach, new sessions are captured via sessions skill automatically. This import mechanism is only needed to:\n1. Import old sessions before we had the skill\n2. Archive sessions from other projects\n\nConsider: Move to backlog (priority 4) until structured summaries are working."}
{"ts":"2025-12-15T14:41:00Z","type":"updated","id":"dp-002","depends_on":["dp-005"],"reason":"Now depends on #005 (sessions skill integration) instead of #001 (JSONL parser). Structured summaries are the foundation."}
{"ts":"2025-12-15T14:41:01Z","type":"updated","id":"dp-001","priority":4,"reason":"Moved to backlog - only needed for optional full transcript drill-down, not for MVP session cards"}
{"ts":"2025-12-15T14:41:02Z","type":"updated","id":"dp-003","priority":4,"depends_on":[],"reason":"Moved to backlog and unblocked - only needed for optional full transcript viewer, not for MVP session cards"}
{"ts":"2025-12-15T14:41:03Z","type":"updated","id":"dp-004","priority":4,"depends_on":[],"reason":"Moved to backlog and unblocked - only needed for importing historical sessions, not for MVP using sessions skill"}
{"ts":"2025-12-15T16:08:57Z","type":"created","id":"dp-011","title":"Consolidate markdown typography CSS","issue_type":"task","priority":2,"description":"The markdown content styles are duplicated between .preview-content (card previews) and .viewer-markdown (viewer modal). These share the same typography rules (h1-h6, lists, tables, code blocks, blockquotes) but are defined separately. Consolidating into shared classes could reduce CSS by ~15-20% and improve maintainability. Low risk refactor - purely cosmetic change."}
{"ts":"2025-12-15T16:14:09Z","type":"note","id":"dp-011","content":"Expanded scope: markdown typography is duplicated in THREE places, not two: .preview-content (card), .viewer-markdown (viewer), and .viewer-description (bookmark descriptions). Also identified: (1) code block styling duplicated between .preview-code and .viewer-code-only, (2) split pane layouts duplicated between preview-split-* and viewer-split-*. Suggested approach: create shared base classes (.md-content, .code-block) with context-specific overrides only where needed."}
{"ts":"2025-12-15T16:50:04Z","type":"note","id":"dp-011","content":"Expanded scope: CSS architecture refactor using cascade layers. Design doc: dev/planning/architecture/css-layers-design.md. Three phases: (1) Add layer infrastructure and inline hljs theme, (2) Organize existing CSS into layers, (3) Consolidate shared patterns like .md-content. Primary benefit: theme.css can override any style without !important."}
{"ts":"2025-12-15T16:55:28Z","type":"created","id":"dp-012","title":"CSS layers phase 1: Infrastructure","issue_type":"task","priority":2,"description":"Add @layer declarations, inline highlight.js atom-one-dark theme in vendors layer, remove CDN link for CSS (keep JS), remove !important from hljs overrides."}
{"ts":"2025-12-15T16:55:28Z","type":"created","id":"dp-013","title":"CSS layers phase 2: Organize into layers","issue_type":"task","priority":2,"description":"Wrap existing CSS in appropriate layer blocks: reset, base, components, templates. Creates clear mental model of where styles belong."}
{"ts":"2025-12-15T16:55:28Z","type":"created","id":"dp-014","title":"CSS layers phase 3: Consolidate patterns","issue_type":"task","priority":2,"description":"Create shared .md-content class for markdown typography. Update render functions to use it. Remove duplicate rules from .preview-content, .viewer-markdown, .viewer-description."}
{"ts":"2025-12-15T16:55:35Z","type":"updated","id":"dp-011","depends_on":["dp-012","dp-013","dp-014"],"reason":"Added blockers: 012, 013, 014"}
{"ts":"2025-12-15T16:55:35Z","type":"updated","id":"dp-013","depends_on":["dp-012"],"reason":"Added blockers: 012"}
{"ts":"2025-12-15T16:55:35Z","type":"updated","id":"dp-014","depends_on":["dp-013"],"reason":"Added blockers: 013"}
{"ts":"2025-12-15T17:08:03Z","type":"closed","id":"dp-012","reason":"Completed: Added @layer declarations, inlined hljs atom-one-dark theme in vendors layer, removed CDN CSS link, removed !important from hljs overrides, added padding:0 overrides for code elements."}
{"ts":"2025-12-15T17:21:21Z","type":"closed","id":"dp-013","reason":"Completed: Organized CSS into layer blocks (reset, base, components, templates). Print styles remain unlayered."}
{"ts":"2025-12-15T17:21:49Z","type":"updated","id":"dp-014","depends_on":[],"reason":"Removed blockers: 013"}
{"ts":"2025-12-15T17:37:33Z","type":"closed","id":"dp-014","reason":"Implemented shared .md-content class for markdown typography. Reduced duplicate CSS by 21 lines."}
{"ts":"2025-12-15T17:38:46Z","type":"closed","id":"dp-011","reason":"All three phases completed: (1) Layer infrastructure with inlined hljs theme, (2) CSS organized into layer blocks, (3) .md-content shared class. Net reduction of ~40 lines while improving maintainability."}
{"ts":"2025-12-15T18:46:55Z","type":"created","id":"dp-015","title":"Issue card template and layouts","issue_type":"feature","priority":2,"description":"Add issue card type to display items from .issues/events.jsonl.\n\n**Design doc:** dev/planning/features/session-card-type.md (see 'Issue Cards: Kanban Integration' section)\n\n**Deliverables:**\n- Add 'issue' template to getDefaultTemplates()\n- Parse .issues/events.jsonl into card data\n- Define schema: id, title, issue_type, priority, description, status, blocked_by, labels, notes\n- Card layout: title, description preview, priority/type badges, blocked-by links\n- Viewer layout: full description, notes timeline, blocked-by/blocking relationships\n\n**Related:** Session cards (#005) - shares JSONL parsing patterns","labels":["enhancement","skill-integration"]}
{"ts":"2025-12-15T18:47:08Z","type":"created","id":"dp-016","title":"Kanban board view for issues section","issue_type":"feature","priority":3,"description":"Add kanban board view as alternative display mode for issues.\n\n**Design doc:** dev/planning/features/session-card-type.md (see 'Kanban Board View' section)\n\n**Columns:**\n- Ready (open, not blocked)\n- In Progress (optional - could track via labels)\n- Blocked (open, has open blockers)\n- Closed\n\n**Deliverables:**\n- Kanban board component with drag-drop columns\n- Toggle button in section header: Cards / Kanban\n- Settings option for default issue display mode\n- Visual indicators for priority and issue type\n\n**Depends on:** Issue card template (#015)","depends_on":["dp-015"],"labels":["enhancement","skill-integration"]}
{"ts":"2025-12-15T18:47:08Z","type":"created","id":"dp-017","title":"Wiki links for issues and sessions","issue_type":"feature","priority":2,"description":"Extend wiki-link syntax to support cross-references between cards, issues, and sessions.\n\n**Design doc:** dev/planning/features/session-card-type.md (see 'Wiki Links' section)\n\n**Syntax:**\n- \\[\\[#005\\]\\] \u2192 Issue by ID\n- \\[\\[session:topic-name\\]\\] \u2192 Session by topic\n- \\[\\[session:2025-12-15\\]\\] \u2192 Sessions by date\n\n**Deliverables:**\n- Parse issue links in markdown content\n- Parse session links in markdown content\n- Render as badge-style clickable links\n- Show title on hover\n- Click opens viewer for linked item\n- Bidirectional link tracking (show 'Referenced by' in viewers)\n\n**Related:** Session cards (#005), Issue cards (#015)","labels":["enhancement","skill-integration"]}
{"ts":"2025-12-15T18:52:47Z","type":"note","id":"dp-005","content":"MVP implementation complete on feature/skill-integration branch:\n\n**Added:**\n- Session template with schema (learnings, open_questions, next_actions, issues_worked)\n- renderSessionPreview() - shows learnings (truncated), issue badges, section counts\n- renderViewerSession() - full display of all sections\n- Load sessions from .memory/sessions.jsonl in loadFromFilesystem()\n- getSystemSubdir() handles .memory/ path\n- CSS styles for card and viewer (TUI-inspired dark theme)\n\n**Sessions appear:** In System section under .memory/ subdirectory\n\n**Not yet implemented:**\n- Wiki links for [[#005]] issue references (tracked in #017)\n- Session editing/saving (sessions are read-only from skill)\n- Linking to full transcript drill-down (backlog items #001, #003)"}
{"ts":"2025-12-15T19:18:20Z","type":"note","id":"dp-005","content":"Implementation complete on feature/skill-integration branch but blocked on skill config question.\n\n**Issue:** research-notebook is a special case - it develops the notebook app, not a notebook of content. The dev/ folder is the natural notebook for development work, so sessions/issues should appear there (dev/.issues/, dev/.memory/) not at repo root.\n\n**Problem:** Skills use symlinked directories, so we can't shadow with local config.yaml inside the skill folder. Putting config outside the skill folder feels hacky and breaks self-containment.\n\n**Options explored:**\n1. Environment variable - unclear when/how it gets set\n2. Config file next to symlink (outside skill dir) - breaks self-containment\n3. Command-line args with CLAUDE.md coordination - error-prone\n4. Copy skill instead of symlink - loses auto-updates\n\n**Decision:** Needs more thought. Parking this to discuss skill configuration patterns."}
{"ts":"2025-12-15T20:20:41Z","type":"created","id":"dp-018","title":"Notebook root auto-discovery","issue_type":"feature","priority":2,"description":"Auto-detect .notebook/ in subdirectories when opening parent. See dev/planning/features/repo-dev-companion.md"}
{"ts":"2025-12-15T20:20:53Z","type":"note","id":"dp-018","content":"Problem: File System Access API grants permissions per directory tree. Opening subdirectory (dev/) doesn't grant access to parent resources (.memory/, .issues/).\n\nSolution: Open parent for permissions, auto-detect subdirectories with .notebook/, prompt user to select which notebook to open.\n\nBonus: Enables switching between multiple notebooks in a monorepo.\n\nUnblocks: Session cards (#005) working in dev notebook scenario.\n\nDesign doc: dev/planning/features/repo-dev-companion.md (Option A)"}
{"ts":"2025-12-15T20:20:59Z","type":"note","id":"dp-005","content":"Created issue #018 (Notebook root auto-discovery) to address the permission scope limitation blocking session cards in dev notebook. This is the clean architectural fix rather than a workaround."}
{"ts":"2025-12-16T10:31:48Z","type":"closed","id":"dp-001","reason":"Abandoned: Sessions are process logs, not notebook artifacts. Decision recorded in repo-dev-companion.md"}
{"ts":"2025-12-16T10:31:48Z","type":"closed","id":"dp-002","reason":"Abandoned: Sessions are process logs, not notebook artifacts. Decision recorded in repo-dev-companion.md"}
{"ts":"2025-12-16T10:31:48Z","type":"closed","id":"dp-003","reason":"Abandoned: Sessions are process logs, not notebook artifacts. Decision recorded in repo-dev-companion.md"}
{"ts":"2025-12-16T10:31:48Z","type":"closed","id":"dp-004","reason":"Abandoned: Sessions are process logs, not notebook artifacts. Decision recorded in repo-dev-companion.md"}
{"ts":"2025-12-16T10:31:48Z","type":"closed","id":"dp-005","reason":"Abandoned: Sessions are process logs, not notebook artifacts. Notebook is for lasting artifacts (notes, design docs), not transient process tracking. TUI may be better tool for sessions/issues. Decision recorded in repo-dev-companion.md"}
{"ts":"2025-12-16T10:31:55Z","type":"closed","id":"dp-015","reason":"Abandoned: Issues are process logs, not notebook artifacts. Decision recorded in repo-dev-companion.md"}
{"ts":"2025-12-16T10:31:55Z","type":"closed","id":"dp-016","reason":"Abandoned: Kanban view depended on issue cards (#015), which are no longer planned"}
{"ts":"2025-12-16T10:31:55Z","type":"closed","id":"dp-017","reason":"Abandoned: Wiki links for issues/sessions no longer needed as skill cards are not being implemented"}
{"ts":"2025-12-16T10:31:56Z","type":"closed","id":"dp-018","reason":"Abandoned: Permission scope auto-discovery was needed for skill card integration, which is no longer planned"}
{"ts":"2025-12-26T11:30:00Z","type":"created","id":"dp-019","title":"Multi-file architecture: Directory structure","issue_type":"task","priority":1,"description":"Create directory structure for multi-file architecture and convert themes to ES modules.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md\n\n**Deliverables:**\n- Create directory structure: css/, js/, defaults/, defaults/templates/\n- Convert themes/*.css to themes/*.js (export CSS as default string)\n- Create themes/index.js registry listing available themes\n- Verify ES module imports work with file:// protocol\n\n**Branch:** refactor/multi-file-architecture","labels":["architecture","refactor"]}
{"ts":"2025-12-26T11:30:01Z","type":"created","id":"dp-020","title":"Multi-file architecture: Extract CSS","issue_type":"task","priority":1,"description":"Extract all CSS from research_notebook.html to css/app.css.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md (Phase 2)\n\n**Deliverables:**\n- Create css/app.css with all styles from HTML_HEAD section\n- Create index.html with link to stylesheet\n- Verify all styling works correctly\n- Keep @layer structure intact\n\n**Branch:** refactor/multi-file-architecture","depends_on":["dp-019"],"labels":["architecture","refactor"]}
{"ts":"2025-12-26T11:30:02Z","type":"created","id":"dp-021","title":"Multi-file architecture: Extract JavaScript","issue_type":"task","priority":1,"description":"Extract JavaScript from research_notebook.html to ES modules in js/.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md (Phase 3)\n\n**Deliverables:**\n- Create js/app.js as entry point\n- Extract sections to modules: state.js, render.js, editor.js, filesystem.js, templates.js, pyodide.js, codemirror.js\n- Convert to ES module exports/imports\n- Maintain single source of truth for state\n- Update index.html with script type=\"module\"\n\n**Note:** This is the largest phase. May need to be broken into sub-tasks.\n\n**Branch:** refactor/multi-file-architecture","depends_on":["dp-020"],"labels":["architecture","refactor"]}
{"ts":"2025-12-26T11:30:03Z","type":"created","id":"dp-022","title":"Multi-file architecture: Defaults as ES modules","issue_type":"task","priority":1,"description":"Convert embedded defaults (templates, theme, CLAUDE.md, README.md) to ES modules.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md (Phase 4)\n\n**Deliverables:**\n- Create defaults/templates/note.js, code.js, bookmark.js (export YAML strings)\n- Create defaults/theme.js (export default CSS)\n- Create defaults/claude-md.js and readme.js\n- Update app to import defaults instead of using inline strings\n- Implement lazy/copy-on-write: defaults load from app, write to notebook on edit\n\n**Branch:** refactor/multi-file-architecture","depends_on":["dp-021"],"labels":["architecture","refactor"]}
{"ts":"2025-12-26T11:30:04Z","type":"created","id":"dp-023","title":"Multi-file architecture: Theme picker UI","issue_type":"feature","priority":2,"description":"Add theme picker to settings for browsing and applying themes.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md (Phase 5)\n\n**Deliverables:**\n- Add 'Theme' section to settings modal\n- List available themes from themes/index.js registry\n- Show theme name and description\n- Preview button (optional: live preview without saving)\n- Apply button writes selected theme to notebook's .notebook/theme.css\n- Current theme indicator\n\n**Branch:** refactor/multi-file-architecture","depends_on":["dp-022"],"labels":["enhancement","themes"]}
{"ts":"2025-12-26T11:30:05Z","type":"created","id":"dp-024","title":"Multi-file architecture: Cleanup and documentation","issue_type":"task","priority":2,"description":"Final cleanup after multi-file migration.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md (Phase 6)\n\n**Deliverables:**\n- Remove old research_notebook.html (or keep as legacy reference)\n- Update CLAUDE.md for new structure (navigation, section markers no longer needed)\n- Update README.md with new usage instructions\n- Evaluate generate_index.py - update or remove\n- Update example notebooks if needed\n- Merge to main\n\n**Branch:** refactor/multi-file-architecture","depends_on":["dp-023"],"labels":["documentation","refactor"]}
{"ts":"2025-12-26T11:30:06Z","type":"created","id":"dp-025","title":"Decision: CLAUDE.md initialization for notebooks","issue_type":"task","priority":2,"description":"Decide how notebooks get CLAUDE.md for Claude Code integration.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md (Open Question 1)\n\n**Options:**\na. CLI initializer: python scripts/init_notebook.py /path/to/notebook\nb. App button: 'Initialize for Claude Code' in toolbar/settings\nc. Documentation only: 'Copy defaults/CLAUDE.md to your notebook'\nd. Auto-create on first save: ensure CLAUDE.md exists when any card is saved\n\n**Considerations:**\n- Claude Code needs CLAUDE.md in notebook directory to work\n- Users may not realize this requirement\n- Option (b) provides discoverability\n- Option (d) is most seamless but may create files unexpectedly\n\n**Outcome:** Document decision in ADR","labels":["decision","architecture"]}
{"ts":"2025-12-26T14:16:22Z","type":"note","id":"dp-025","content":"DECIDED: Use example notebooks as templates. See ADR multi-file-architecture.md Open Question #1. Different use cases (research, tutor, dev) get tailored CLAUDE.md, theme, and README. Card templates only included if customized from defaults."}
{"ts":"2025-12-26T14:16:28Z","type":"closed","id":"dp-025","reason":"Decided: example notebooks as templates. Creating implementation issue."}
{"ts":"2025-12-26T14:18:02Z","type":"created","id":"dp-026","title":"Create example notebook templates","issue_type":"task","priority":2,"description":"Create example notebooks for different use cases, each with tailored CLAUDE.md, theme, and README.\n\n**ADR:** dev/planning/architecture/multi-file-architecture.md (Open Question #1 - DECIDED)\n\n**Deliverables:**\n\n1. **research-notebook/** - Standard research use\n   - CLAUDE.md with research-focused instructions\n   - theme.css pointing to manuscript theme\n   - README.md explaining the template\n\n2. **tutor-notebook/** - AI tutoring collaboration\n   - CLAUDE.md with student collaboration guidelines\n   - theme.css with accessible, friendly theme\n   - README.md explaining the use case\n\n3. **dev-notebook/** - Development/coding focus\n   - CLAUDE.md with code-focused instructions\n   - theme.css pointing to terminal theme\n   - README.md explaining the template\n\n4. **Optional: scripts/new-notebook.py** - CLI helper to list and copy examples\n\n**Principle:** Only include .notebook/templates/*.yaml if genuinely customized for that use case. Standard types inherit from app defaults via lazy/copy-on-write.\n\n**Note:** Existing demo-notebook can be kept or refactored into one of these.","labels":["architecture","examples"]}
{"ts":"2025-12-26T14:18:08Z","type":"updated","id":"dp-026","depends_on":["dp-022"],"reason":"Added dependencies: dp-022"}
{"ts":"2025-12-26T14:21:13Z","type":"note","id":"dp-022","content":"Updated: Remove defaults/claude-md.js and defaults/readme.js from deliverables. These files now live only in example notebooks (see dp-026). defaults/ only contains templates/*.js and theme.js."}
{"ts":"2025-12-26T14:21:13Z","type":"updated","id":"dp-024","depends_on":["dp-023","dp-026"],"reason":"Added dependencies: dp-026"}
{"ts":"2025-12-26T14:28:27Z","type":"note","id":"dp-019","content":"Completed all deliverables:\n- Created directory structure: css/, js/, defaults/, defaults/templates/\n- Converted 4 themes (manuscript, minimal, terminal, handwritten) to ES modules\n- Created themes/index.js registry with loadTheme() and getThemeCSS() helpers\n- Created test-es-modules.html for browser verification\n- Updated themes/README.md with ES module documentation\n\nNode.js testing confirms modules work correctly. Browser testing with file:// protocol should be done manually by opening test-es-modules.html in Chrome/Edge."}
{"ts":"2025-12-26T14:28:35Z","type":"closed","id":"dp-019","reason":"Done - Created multi-file architecture directory structure and converted themes to ES modules. See test-es-modules.html for browser verification."}
{"ts":"2025-12-26T14:34:27Z","type":"note","id":"dp-020","content":"Completed extraction:\n- Created css/app.css with all 2266 lines of CSS\n- Created index.html (6752 lines) linking to css/app.css\n- @layer structure preserved: reset, vendors, base, components, templates, theme\n- Print styles remain unlayered (as intended for proper precedence)\n\nFiles:\n- index.html: 306KB (replaces inline styles with <link> tag)\n- css/app.css: 49KB (extracted CSS)\n- research_notebook.html: 371KB (original, kept for reference during migration)\n\nNeeds manual verification: open index.html in browser to confirm styling works."}
{"ts":"2025-12-26T14:38:44Z","type":"closed","id":"dp-020","reason":"Done - Extracted CSS to css/app.css, created index.html with stylesheet link. Styling verified working."}
{"ts":"2025-12-26T14:59:24Z","type":"note","id":"dp-021","content":"Phase 3 extraction complete: JS extracted to js/app.js (246KB). index.html now 210 lines. Follow-up needed: split app.js into ES modules (state.js, templates.js, etc.)"}
{"ts":"2025-12-26T14:59:36Z","type":"created","id":"dp-027","title":"Multi-file architecture: Split app.js into ES modules","issue_type":"task","priority":2,"description":"Split js/app.js (~6500 lines) into ES modules:\n\n- state.js: Global state variables\n- utilities.js: Helper functions (escapeHtml, formatDate, etc.)\n- templates.js: TEMPLATE_SYSTEM section (~2200 lines)\n- filesystem.js: FILESYSTEM_STORAGE + DATA_PERSISTENCE (~1500 lines)\n- editor.js: GENERIC_EDITOR section (~1350 lines)\n- pyodide.js: PYODIDE_RUNTIME section\n- render.js: RENDER_FUNCTIONS section\n- links.js: INTERNAL_LINKING section\n- thumbnails.js: THUMBNAIL_GENERATION section\n- modals.js: UI modals and small sections\n\nKey challenges:\n- Circular dependencies between templates/filesystem/editor\n- HTML onclick handlers need functions on window object\n- Use late-binding pattern for cross-module deps\n\n**Branch:** refactor/multi-file-architecture","depends_on":["dp-021"],"labels":["architecture","refactor"]}
{"ts":"2025-12-26T15:01:15Z","type":"closed","id":"dp-021","reason":"JS extracted to js/app.js. ES module splitting tracked in dp-027."}
{"ts":"2025-12-26T15:01:54Z","type":"note","id":"dp-027","content":"Learnings from attempted all-in-one refactor:\n\n1. **Circular deps are real**: templates.js \u2194 filesystem.js \u2194 editor.js all call each other\n2. **State vars need setters**: 'let' vars (data, pyodide, etc.) can't be reassigned from other modules - need 'setData()' pattern\n3. **HTML onclick handlers**: Functions like openEditor(), closeViewer() must be exposed on window object\n4. **Late binding pattern**: Import modules at top, but only call cross-module functions inside other functions (not at load time)\n5. **Consider app.js as coordinator**: Import all modules, wire up cross-deps via registration functions, expose onclick handlers on window"}
{"ts":"2025-12-26T15:10:55Z","type":"note","id":"dp-027","content":"Extracted 2 modules: utilities.js (61 lines) and pyodide.js (239 lines). App now uses ES module loading. Internal-linking extraction deferred due to data/viewer dependencies."}
{"ts":"2025-12-26T15:14:06Z","type":"note","id":"dp-027","content":"Fixed: Using regular script loading instead of ES modules for file:// protocol compatibility. Scripts load in order: utilities.js \u2192 pyodide.js \u2192 app.js"}
{"ts":"2025-12-26T15:17:18Z","type":"closed","id":"dp-027","reason":"Abandoned: ES modules require server (incompatible with file:// protocol). Regular script splitting provides no real encapsulation benefit. Single app.js with section markers + generate_index.py is cleaner for this use case."}
{"ts":"2025-12-26T16:26:17Z","type":"closed","id":"dp-022","reason":"Abandoned: ES modules rejected - requires server (incompatible with file:// protocol design goal). Templates/themes can be embedded in js/app.js or loaded differently in the future. See ADR multi-file-architecture.md for full rationale."}
{"ts":"2025-12-26T16:26:24Z","type":"updated","id":"dp-026","depends_on":[],"reason":"Removed dependencies: dp-022"}
{"ts":"2025-12-26T16:26:30Z","type":"updated","id":"dp-023","depends_on":[],"reason":"Removed dependencies: dp-022"}
{"ts":"2025-12-26T16:26:37Z","type":"note","id":"dp-024","content":"Partial completion: research_notebook.html and test-es-modules.html removed. CLAUDE.md and README.md updated for multi-file structure. generate_index.py updated to point at js/app.js. Remaining: merge to main after example notebooks (dp-026) complete."}
{"ts":"2025-12-26T16:29:02Z","type":"note","id":"dp-026","content":"Created 3 example notebooks: research-notebook (manuscript theme), dev-notebook (terminal theme), tutor-notebook (friendly theme). Each has CLAUDE.md, README.md, .notebook/settings.yaml, and .notebook/theme.css. Kept existing demo-notebook as full-featured reference."}
{"ts":"2025-12-26T16:29:07Z","type":"closed","id":"dp-026","reason":"Completed: Created research-notebook, dev-notebook, and tutor-notebook examples. Each has tailored CLAUDE.md, theme.css, README.md, and settings.yaml. Demo-notebook kept as full-featured reference."}
{"ts":"2025-12-26T16:38:59Z","type":"created","id":"dp-028","title":"Remove auto-creation of default Research section","issue_type":"bug","priority":2,"description":"When opening an empty notebook folder, the app automatically creates a 'Research' section (js/app.js:5151-5159). This is unwanted - users should start with an empty notebook and add their first section via the Add Section button.\n\n**Current behavior:**\n- New notebook auto-creates 'Research' section directory\n- settings.yaml includes this section\n\n**Desired behavior:**\n- New notebook starts empty (no sections)\n- User clicks Add Section to create their first section\n- settings.yaml has empty sections array\n\n**Location:** `linkFilesystem()` function around line 5150 in js/app.js\n\n**Note:** Also update `getDefaultSettingsContent()` (line 673) to default to empty sections array."}
{"ts":"2025-12-26T16:39:44Z","type":"closed","id":"dp-028","reason":"Fixed: Removed auto-creation of Research section. New notebooks now start empty. Updated linkFilesystem() and SETTINGS_SCHEMA defaults."}
{"ts":"2025-12-26T16:45:37Z","type":"updated","id":"dp-024","depends_on":["dp-026"],"reason":"Removed dependencies: dp-023"}
{"ts":"2025-12-26T16:45:42Z","type":"updated","id":"dp-024","depends_on":[],"reason":"Removed dependencies: dp-026"}
{"ts":"2025-12-26T16:45:50Z","type":"closed","id":"dp-024","reason":"Completed: Removed old HTML files, updated CLAUDE.md and README.md for multi-file structure, updated generate_index.py for js/app.js, created 3 example notebooks. Theme picker (dp-023) is a separate future feature. Ready for merge to main."}
